@using Lumos.Data.Enums;
@using Newtonsoft.Json;

@{
    Layout = null;
}

@model Lumos.Application.Dtos.Management.UsersDto;

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <p style="font-size: 1.1em!important;margin: 0; font-weight: bold;">Editar Usuário</p>
</div>

<div class="modal-body">
    <form id="editUser" style="margin: auto!important">
        <input type="hidden" name="TenantId" value="@Model.TenantId" />
        <input type="hidden" name="Id" id="Id" value="@Model.Id" />

        <div class="row">
            <div class="form-group col-md-6">
                <label for="Email" class="input-label">E-mail<span class="input-label-required"></span></label>
                <input type="text" class="form-control" name="Email" id="Email" placeholder="" autocomplete="email" value="@Model.Email">
            </div>

            <div class="form-group col-md-6">
                <label for="FullName" class="input-label">Nome Completo<span class="input-label-required"></span></label>
                <input type="text" class="form-control" name="FullName" id="FullName" placeholder="" autocomplete="fullName" value="@Model.FullName">
            </div>
        </div>

        <div class="row">
            <div class="form-group col-md-6">
                <label for="Password" class="input-label">Senha<span class="input-label-required"></span></label>
                <div class="input-group">
                    <input type="password" class="form-control" name="Password" id="Password" placeholder="" autocomplete="password" value="@Model.DecryptedPassword">
                    <span class="input-group-addon toggle-password" style="cursor: pointer;">
                        <i class="fa fa-eye"></i>
                    </span>
                </div>
            </div>

            <div class="form-group col-md-6">
                <label for="Cpf" class="input-label">CPF<span class="input-label-required"></span></label>
                <input type="text" class="form-control" name="Cpf" id="Cpf" placeholder="" value="@Model.Cpf">
            </div>
        </div>
        <div class="row" style="padding: 0 15px;">
            <div class="form-group col-md-12">
                <label for="SelectedUnits" class="input-label">Selecionar Unidades<span class="input-label-required"></span></label>
                <select id="SelectedUnits" class="form-control" multiple required></select>
            </div>
        </div>
    </form>
</div>

<script>
    $('.toggle-password').click(function () {
        var $input = $(this).closest('.input-group').find('input');
        var type = $input.attr('type') === 'password' ? 'text' : 'password';
        $input.attr('type', type);
        $(this).find('i').toggleClass('fa-eye fa-eye-slash');
    });

    $('#UserEditModal').on('shown.bs.modal', function () {
        var units = @Html.Raw(JsonConvert.SerializeObject(Model.Units, new JsonSerializerSettings { ReferenceLoopHandling = ReferenceLoopHandling.Ignore }));

        console.log(units);

        var $selectedUnits = $("#SelectedUnits");
        $selectedUnits.empty();

        units.forEach(function (unit) {
            var option = $("<option>", {
                value: unit.Id,
                text: unit.Name,
                selected: true
            });
            $selectedUnits.append(option);
        });

        InitializeSelect2("#SelectedUnits", "Selecione as Unidades");
    });

    $("#editUser").on('submit', function (e) {
        e.preventDefault();

        var id = $('#UnitId').val();
        var formData = new FormData($('#editUser')[0]);

        var url = `/Users/Update/${id}`;

        AjaxUpdateDefault("#submitButton", url, formData, "#UserEditModal");
    })
</script>
